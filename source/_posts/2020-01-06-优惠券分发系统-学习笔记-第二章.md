---
title: 优惠券分发系统-学习笔记-第二章
date: 2020-01-06 21:17:41
tags:
    - 学习笔记
categories: 学习笔记
---
> 第二章学习旅程记录

<!-- more -->

## Maven

### maven 常用命令

- mvn -v 查看版本
- mvn compile 编译
- mvn test 执行测试用例
- mvn package 打包成 jar 包
- mvn clean 清楚 target 下的内容
- mvn install 当前项目安装到本地

可以再命令后加入参数 **-Dmaven.test.skip=true -U** 来跳过测试用例的测试。

### maven 常用概念

传递依赖：直接引入的 jar 包和它依赖的间接引入的 jar 包都会被引入。

依赖排除：可以再 pom.xml 中通过指明要排除依赖的 jar 包的坐标来排除不需要的依赖。

```xml
<dependency>
	<groupId>org.apache.hbasee</groupId>
	<artifactId>hbase</artifactId>
	<version>0.94.17</version>
	<exclusions>
		<exclusion>
			<groupId>commons-logging</groupId>
			<artifactId>commons-logging</artifactId>
		</exclusion>
	</exclusions>
</dependency>
```

### maven 冲突解决

maven 理论上不会发生依赖冲突，因为 maven 具有下列特征

- 短路优先
- 声明优先

短路优先即发生依赖冲突时，谁短先引用谁，所以不会存在依赖冲突。

声明优先即如果发生冲突且长度一致，谁先声明，引用谁。

### maven 多项目/模块聚合知识点
- 父模块项目POM的 packing 类型必须是 pom
- 聚合子模块使用 modules标签
- 使用父模块来统一管理依赖包，使用 dependencyManagement 标签
    - dependencies 标签声明的子模块都会全部继承。
    - dependencyManagement 只是在父类进行声明，子模块声明后才进行引入。
    - 通过 dependencyManagement 声明的，子模块需要显示声明的依赖，才会进行继承。
    - 子项目如果需要指定版本，显式指定版本号即可。
- 子模块需要在 POM 中声明父模块，从而进行依赖引用等。

## Redis

Redis 是一个基于内存的 key-value 数据库，也可以称作缓存数据库，它不需要提前定义 scheme，所以是非关系型数据库。

Redis 所有操作都是原子的，是数据库事务的特性，即要不全执行，要不全都不执行。这是数据库理论里面的原子性，即操作不可继续划分，为最小操作。原因是因为 Redis 的IO模型是单线程，单进程，顺序操作。

### 常用数据类型

- String
    - 最基本的类型，二进制存储，所以可以包含任何数据，单个value的最大可以为1GB
- List
    - 存储序列集合，有序
    - 双向列表实现
    - 可以当做栈和队列
    - 不要求元素唯一
- Hash
    - 字典
    - 存储多个 key-value 数据
    - 多个 key-value 是一类的
    - 类似 java hashmap
- Set
    - 无序的方式存储多个不同的元素。
    - 相同元素只保存一个
    - 最大长度为 2的32次方-1
    - 除了基本操作外，还包含集合的并集，交集，差集等操作
- SortedSet
    - 与 set 类型类型
    - 不同的是，每个元素都关联一个浮点数的权重值
    - 通过权重值来有序的获取集合中的元素
    - 如果元素权重一致，则按照元素的字节排序来获取
    - 最常见应用，排行榜

### Key 过期策略

redi可以对 key 设置过期时间，理论上实现方式有三种

1. 定时删除
    - 即创建key时启动一个定时器，到时间进行删除，不浪费内存，但消耗了CPU资源
2. 惰性删除
    - 不管key是否过期，但每次获取key时，要进行检查，如果过期，则删除key
    - 平时不处理，使用时进行检查，过期则删除，未过期则返回该值。
    - 浪费了内存，但节约了CPU资源
    - 假如一个key永远不使用，则会一直保存在内存中，浪费内存
3. 定期删除
    - 启动一个定时器，按照一定时间标准，对所有过期的key进行删除，耗费了内存，CPU占用优化

redis 的过期策略是使用了 惰性删除和定期删除

### Redis 持久化方式

- RDB （默认方式，快照）
    - 定期全量持久化数据到内存
    - 占用资源多
    - 定期间隔长，恢复时可能丢失数据
    - 一般线上环境不采用
    - 恢复速度快
- AOF （APPEND OPERATION FILE）
    - 把用户写指令保存在文件中
    - 占用资源少
    - 恢复慢
    - 正式环境一般采用该方式

### Redis 速度快的原因

- 完全基于内存
- 数据结构简单，避免了一些复杂操作
- 单线程，没有线程切换和竞争带来的性能影响
- 多路IO复用模型

### Redis 常见问题

- 缓存穿透
    - cache 不命中，数据库中又没有，查询了两次，性能低下。
    - 解决办法：给没有命中的key设定没有意义的空值
- 缓存雪崩
    - 同一批cache设置了相同的过期时间，同一时间失效，请求全部转发的DB，操作DB压力过大
    - 解决办法：给key设定不同的（随机的）过期时间

### Redis IO 模型

#### 基本概念

> 文件描述符：内核（kernel）利用文件描述符（file descriptor）来访问文件。文件描述符是非负整数。打开现存文件或新建文件时，内核会返回一个文件描述符。读写文件也需要使用文件描述符来指定待读写的文件。简称 FD

#### 常见 IO 模型

1. Blocking IO 阻塞型
    - 当 read/write 对某一个文件描述符（FD）进行读写时，如果当前FD不可读或不可写，则服务阻塞
2. IO 多路复用模型
    - 同时监控（select/epoll 根据操作系统不同和性能不能进行选择，优先选择性能高的函数）多个FD的可读可写状态，当其中的某些FD可读或可写时，就返回可读以及可写的文件描述符（个数）

#### Redis IO 模型

![Redis IO 模型](https://user-images.githubusercontent.com/21177719/71820270-9aafe580-30c9-11ea-9d8f-7df507675d55.png)

每一个网络连接（访问redis的请求）对应的是一个文件描述符，即FD
通过 redis IO 多路复用模块，去找到一个可操作的FD，然后交给 redis 事件分发器（单线程），去交给 redis 事件处理器来执行操作，从而达到了单线程，但是能处理多个任务。
